###############################################################################
diccionario_clasificado <- diccionario_clasificado %>%
add_row(
codigo = "p39_lugar_agregado",
descripcion = "Lugar donde ocurrió la situación (categorías agrupadas)",
modulo = "Módulo 4: Experiencias de acoso, inseguridad y VBG"
)
###############################################################################
## Guardar diccionario y dataset
###############################################################################
writexl::write_xlsx(dataset, "output/clean_cali_dataset_21102025.xlsx")
writexl::write_xlsx(diccionario_clasificado, "output/diccionario_cali.xlsx")
source("C:/Users/sergio.barona/Desktop/Natura/201025_Results/descriptive/m3_by_control.R", echo=TRUE)
source("aux_functions/aux_summary.R")
library(dplyr)
library(readxl)
library(writexl)
library(tidyverse)
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
dataset <- read_excel("output/clean_cali_dataset_21102025.xlsx")
diccionario_clasificado <- read_excel("output/diccionario_cali.xlsx")
###############################################################################
# DESCRIPTIVE SUMMARIES BY GROUP
# Módulo 3: Percepciones, preferencias y deseos
# Descripción:
#   Genera tablas descriptivas (n(%), mediana [Q1–Q3])
#   para las variables del Módulo 3, diferenciadas por:
#     1. Género
#     2. Estrato socioeconómico
#     3. Modo de transporte principal
#   Las tablas se exportan en formato Excel para análisis posterior.
###############################################################################
## ============================================================================
## 0. Cargar entorno y funciones auxiliares
## ============================================================================
source("aux_functions/aux_summary.R")
library(dplyr)
library(readxl)
library(writexl)
library(tidyverse)
## ============================================================================
## 1. Cargar datos y diccionario
## ============================================================================
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
dataset <- read_excel("output/clean_cali_dataset_21102025.xlsx")
diccionario_clasificado <- read_excel("output/diccionario_cali.xlsx")
# Seleccionar variables del Módulo 3
vars_m3 <- diccionario_clasificado %>%
filter(modulo == "Módulo 3: Percepciones, preferencias y deseos")
# Crear carpeta de salida si no existe
if (!dir.exists("output/m3")) dir.create("output/m3", recursive = TRUE)
## ============================================================================
## 2. Preparar datos base
## ============================================================================
# Mantener solo observaciones con género definido (Hombre / Mujer)
dataset <- dataset %>%
filter(p40 %in% c("Mujer", "Hombre"))
# Subconjunto de variables del módulo
df_m3 <- dataset %>% select(all_of(vars_m3$codigo))
## ============================================================================
## 3. Clasificación de variables del Módulo 3
## ============================================================================
# Variables categóricas (respuestas nominales o múltiples)
cat_to_describe <- c(
"p24",                         # Satisfacción general o percepción
"p25_razones_agregadas",       # Razones para elección de modo
"p26_agregado",                # Aspecto que menos le gusta
"p27_situaciones_multiples",   # Situaciones percibidas / evitadas
"p29_modo_ideal_agregado",     # Modo de transporte ideal
"p30_razon_no_uso_agregado",   # Razones para no usar modo ideal
"p31_fuente_contaminacion_agregada", # Fuente percibida de contaminación
"p33_modo_contaminante_agregado",    # Modo más contaminante percibido
"p35_razon_agregada"                # Razones principales (agregadas)
)
# Variables ordinales (tipo Likert o escala 1–5)
cont_to_describe <- c(
"p28_importancia_costo_compra",
"p28_importancia_costo_uso",
"p28_importancia_comodidad",
"p28_importancia_tiempo",
"p28_importancia_riesgo_robo",
"p28_importancia_riesgo_acoso",
"p28_importancia_discriminacion",
"p28_importancia_emisiones",
"p28_importancia_siniestralidad",
"p32_contaminacion_likert",
"p36_influencia_amigos",
"p37_influencia_familia"
)
## ============================================================================
## 4. Descripción por género
## ============================================================================
tabla_m3_gender <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p40",  # Variable de control: Género
diccionario = diccionario_clasificado
)
# Exportar resultados
write_xlsx(tabla_m3_gender, "output/m3/21102025_mod3_by_gender.xlsx")
## ============================================================================
## 5. Descripción por nivel socioeconómico (SES)
## ============================================================================
tabla_m3_ses <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p9_estrato3",  # Variable de control: Estrato
diccionario = diccionario_clasificado
)
write_xlsx(tabla_m3_ses, "output/m3/21102025_mod3_by_ses.xlsx")
## ============================================================================
## 6. Descripción por modo de transporte principal
## ============================================================================
tabla_m3_travel <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p17_modo_agregado",  # Variable de control: Modo principal
diccionario = diccionario_clasificado
)
write_xlsx(tabla_m3_travel, "output/m3/21102025_mod3_by_travel_mode.xlsx")
source("aux_functions/aux_summary.R")
library(dplyr)
library(readxl)
library(writexl)
library(tidyverse)
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
dataset <- read_excel("output/clean_cali_dataset_21102025.xlsx")
diccionario_clasificado <- read_excel("output/diccionario_cali.xlsx")
# Seleccionar variables del Módulo 4
vars_m4 <- diccionario_clasificado %>%
filter(modulo == "Módulo 4: Experiencias de acoso, inseguridad y VBG")
# Crear carpeta de salida si no existe
if (!dir.exists("output/m4")) dir.create("output/m4", recursive = TRUE)
# Mantener solo observaciones con género definido (Hombre / Mujer)
dataset <- dataset %>%
filter(p40 %in% c("Mujer", "Hombre"))
# Subconjunto de variables del módulo
df_m4 <- dataset %>% select(all_of(vars_m4$codigo))
# Variables categóricas (respuestas nominales o múltiples)
cat_to_describe <- c(
"p38p38_1",
"p38p38_2",
"p38p38_3",
"p38p38_4",
"p38p38_5",
"p38p38_6",
"p38p38_7",
"p38p38_99",
"p38_99_otro",
"p39",
"p39_otro",
"p39_1",
"p39_1_1",
"p39_1_2",
"p39_1_otro",
"p39_2",
"p39_lugar_agregado"
)
# En este módulo no hay variables continuas ni Likert puras
cont_to_describe <- c()
cat("\nGenerando resumen por género...\n")
tabla_m4_gender <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p40",  # Variable de control: Género
diccionario = diccionario_clasificado
)
View(tabla_m4_gender)
###############################################################################
# DESCRIPTIVE SUMMARIES BY GROUP
# Módulo 4: Experiencias de acoso, inseguridad y VBG
# Descripción:
#   Este script genera tablas descriptivas (n(%), mediana [Q1–Q3])
#   para las variables del Módulo 4, diferenciadas por:
#     1. Género
#     2. Estrato socioeconómico
#     3. Modo de transporte principal
#   Las tablas se exportan a archivos Excel para análisis posterior.
###############################################################################
## ============================================================================
## 0. Cargar entorno y funciones auxiliares
## ============================================================================
source("aux_functions/aux_summary.R")
library(dplyr)
library(readxl)
library(writexl)
library(tidyverse)
## ============================================================================
## 1. Cargar datos y diccionario
## ============================================================================
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
dataset <- read_excel("output/clean_cali_dataset_21102025.xlsx")
diccionario_clasificado <- read_excel("output/diccionario_cali.xlsx")
# Seleccionar variables del Módulo 4
vars_m4 <- diccionario_clasificado %>%
filter(modulo == "Módulo 4: Experiencias de acoso, inseguridad y VBG")
# Crear carpeta de salida si no existe
if (!dir.exists("output/m4")) dir.create("output/m4", recursive = TRUE)
## ============================================================================
## 2. Preparar datos base
## ============================================================================
# Mantener solo observaciones con género definido (Hombre / Mujer)
dataset <- dataset %>%
filter(p40 %in% c("Mujer", "Hombre"))
# Subconjunto de variables del módulo
df_m4 <- dataset %>% select(all_of(vars_m4$codigo))
## ============================================================================
## 3. Clasificación de variables del Módulo 4
## ============================================================================
# Variables categóricas (respuestas nominales o múltiples)
cat_to_describe <- c(
"p38p38_1",
"p38p38_2",
"p38p38_3",
"p38p38_4",
"p38p38_5",
"p38p38_6",
"p38p38_7",
"p38p38_99"
)
# En este módulo no hay variables continuas ni Likert puras
cont_to_describe <- c()
## ============================================================================
## 4. Descripción por género
## ============================================================================
tabla_m4_gender <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p40",  # Variable de control: Género
diccionario = diccionario_clasificado
)
# Exportar resultados
write_xlsx(tabla_m4_gender, "output/m4/21102025_mod4_by_gender.xlsx")
## ============================================================================
## 5. Descripción por nivel socioeconómico (SES)
## ============================================================================
tabla_m4_ses <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p9_estrato3",  # Variable de control: Estrato
diccionario = diccionario_clasificado
)
write_xlsx(tabla_m4_ses, "output/m4/21102025_mod4_by_ses.xlsx")
## ============================================================================
## 6. Descripción por modo de transporte principal
## ============================================================================
tabla_m4_travel <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p17_modo_agregado",  # Variable de control: Modo principal
diccionario = diccionario_clasificado
)
write_xlsx(tabla_m4_travel, "output/m4/21102025_mod4_by_travel_mode.xlsx")
## ============================================================================
## 7. Finalización
## ============================================================================
###############################################################################
# DESCRIPTIVE SUMMARIES BY GROUP
# Módulo 2: Movilidad
# Descripción:
#   Este script genera tablas descriptivas (n(%), mediana [Q1–Q3])
#   para las variables del Módulo 2, diferenciadas por:
#   Las tablas se exportan a archivos Excel para análisis posterior.
###############################################################################
## ============================================================================
## 0. Cargar entorno y funciones auxiliares
## ============================================================================
# Función principal para resúmenes
source("aux_functions/aux_summary.R")
# Paquetes requeridos
library(dplyr)
library(readxl)
library(writexl)
library(tidyverse)
## ============================================================================
## 1. Cargar datos y diccionario
## ============================================================================
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
dataset <- read_excel("output/clean_cali_dataset_21102025.xlsx")
diccionario_clasificado <- read_excel("output/diccionario_cali.xlsx")
# Seleccionar variables del Módulo 1
vars_m2 <- diccionario_clasificado %>%
filter(modulo == "Módulo 2: Movilidad")
## ============================================================================
## 2. Preparar datos base
## ============================================================================
# Mantener solo observaciones con género definido (Hombre / Mujer)
dataset <- dataset %>%
filter(p40 %in% c("Mujer", "Hombre"))
# Seleccionar variables relevantes del módulo
df_m2 <- dataset %>% select(all_of(vars_m2$codigo))
# Variables categóricas y continuas a describir
cat_to_describe <- c("edad_r2", "pais",
"p13",
"p14",
"p15_autos_agregado",
"p15_1_autos_propios_agregado",
"p16_motos_agregado",
"p16_1_motos_propias_agregado",
"p17_modo_agregado",
"cilindraje_auto_agregado",
"cilindraje_moto_agregado",
"cilindraje_camion_agregado",
"modelo_vehiculo_agregado",
"p19comuna",
"p23_agregado")
cont_to_describe <- c("p1edad", "p18",
"p18_p1",
"p18_p2",
"p18_p3",
"p18_p4",
"p18_c1")
## ============================================================================
## 3. Descripción por género
## ============================================================================
tabla_m2 <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p40",  # Variable de control: Género
diccionario = diccionario_clasificado
)
# Mostrar y exportar
writexl::write_xlsx(tabla_m2, "output/m2/21102025_mod2_by_gender.xlsx")
## ============================================================================
## 4. Descripción por nivel socioeconómico (SES)
## ============================================================================
tabla_m2 <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p9_estrato3",  # Variable de control: Estrato
diccionario = diccionario_clasificado
)
# Mostrar y exportar
writexl::write_xlsx(tabla_m2, "output/m2/21102025_mod2_by_ses.xlsx")
## ============================================================================
## 5. Descripción por modo de transporte principal
## ============================================================================
tabla_m2 <- describe_by_group(
data = dataset,
vars_cat = cat_to_describe,
vars_cont = cont_to_describe,
control_var = "p17_modo_agregado",  # Variable de control: Modo principal
diccionario = diccionario_clasificado
)
# Mostrar y exportar
writexl::write_xlsx(tabla_m2, "output/m2/21102025_mod2_by_travel_mode.xlsx")
# Agregar tablas de resumen descriptivo
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
# Módulo 1
tablam1_gender = readxl::read_excel("output/m1/21102025_mod1_by_gender.xlsx")
tablam1_ses = readxl::read_excel("output/m1/21102025_mod1_by_ses.xlsx")
tablam1_travel = readxl::read_excel("output/m1/21102025_mod1_by_travel_mode.xlsx")
# Módulo 1
tablam1_gender = readxl::read_excel("output/m1/21102025_v2_mod1_by_gender.xlsx")
tablam1_ses = readxl::read_excel("output/m1/21102025_mod1_by_ses.xlsx")
tablam1_travel = readxl::read_excel("output/m1/21102025_mod1_by_travel_mode.xlsx")
tabla_m1 = cbind(tablam1_gender, tablam1_ses, tablam1_travel)
View(tabla_m1)
colnames(tablam1_gender)
tabla_m1 = merge(tablam1_gender, tablam1_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m1 = merge(tabla_m1, tablam1_travel, by = c("Variable", "Label",
"Categoria"))
# Módulo 2
tablam2_gender = readxl::read_excel("output/m2/21102025_v2_mod2_by_gender.xlsx")
# Módulo 2
tablam2_gender = readxl::read_excel("output/m2/21102025_mod2_by_gender.xlsx")
# Módulo 2
tablam2_gender = readxl::read_excel("output/m2/21102025_mod2_by_gender.xlsx")
tablam2_ses = readxl::read_excel("output/m2/21102025_mod2_by_ses.xlsx")
tablam2_travel = readxl::read_excel("output/m2/21102025_mod2_by_travel_mode.xlsx")
tabla_m2 = merge(tablam2_gender, tablam2_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m2 = merge(tabla_m2, tablam2_travel, by = c("Variable", "Label",
"Categoria"))
# Agregar tablas de resumen descriptivo
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
# Módulo 1
tablam1_gender = readxl::read_excel("output/m1/21102025_v2_mod1_by_gender.xlsx")
tablam1_ses = readxl::read_excel("output/m1/21102025_mod1_by_ses.xlsx")
tablam1_travel = readxl::read_excel("output/m1/21102025_mod1_by_travel_mode.xlsx")
tabla_m1 = merge(tablam1_gender, tablam1_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m1 = merge(tabla_m1, tablam1_travel, by = c("Variable", "Label",
"Categoria"))
# Módulo 2
tablam2_gender = readxl::read_excel("output/m2/21102025_mod2_by_gender.xlsx")
tablam2_ses = readxl::read_excel("output/m2/21102025_mod2_by_ses.xlsx")
tablam2_travel = readxl::read_excel("output/m2/21102025_mod2_by_travel_mode.xlsx")
tabla_m2 = merge(tablam2_gender, tablam2_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m2 = merge(tabla_m2, tablam2_travel, by = c("Variable", "Label",
"Categoria"))
# Módulo 3
tablam3_gender = readxl::read_excel("output/m3/21102025_mod3_by_gender.xlsx")
tablam3_ses = readxl::read_excel("output/m3/21102025_mod3_by_ses.xlsx")
tablam3_travel = readxl::read_excel("output/m3/21102025_mod3_by_travel_mode.xlsx")
tabla_m3 = merge(tablam3_gender, tablam3_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m3 = merge(tabla_m3, tablam3_travel, by = c("Variable", "Label",
"Categoria"))
View(tabla_m2)
# Agregar tablas de resumen descriptivo
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
# Módulo 1
tablam1_gender = readxl::read_excel("output/m1/21102025_v2_mod1_by_gender.xlsx")
tablam1_ses = readxl::read_excel("output/m1/21102025_mod1_by_ses.xlsx")
tablam1_travel = readxl::read_excel("output/m1/21102025_mod1_by_travel_mode.xlsx")
tabla_m1 = merge(tablam1_gender, tablam1_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m1 = merge(tabla_m1, tablam1_travel, by = c("Variable", "Label",
"Categoria"))
# Módulo 2
tablam2_gender = readxl::read_excel("output/m2/21102025_mod2_by_gender.xlsx")
tablam2_ses = readxl::read_excel("output/m2/21102025_mod2_by_ses.xlsx")
tablam2_travel = readxl::read_excel("output/m2/21102025_mod2_by_travel_mode.xlsx")
tabla_m2 = merge(tablam2_gender, tablam2_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m2 = merge(tabla_m2, tablam2_travel, by = c("Variable", "Label",
"Categoria"))
# Módulo 3
tablam3_gender = readxl::read_excel("output/m3/21102025_mod3_by_gender.xlsx")
tablam3_ses = readxl::read_excel("output/m3/21102025_mod3_by_ses.xlsx")
tablam3_travel = readxl::read_excel("output/m3/21102025_mod3_by_travel_mode.xlsx")
tabla_m3 = merge(tablam3_gender, tablam3_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m3 = merge(tabla_m3, tablam3_travel, by = c("Variable", "Label",
"Categoria"))
# Módulo 4
tablam4_gender = readxl::read_excel("output/m4/21102025_mod4_by_gender.xlsx")
tablam4_ses = readxl::read_excel("output/m4/21102025_mod4_by_ses.xlsx")
tablam4_travel = readxl::read_excel("output/m4/21102025_mod4_by_travel_mode.xlsx")
tabla_m4 = merge(tablam4_gender, tablam4_ses, by = c("Variable", "Label",
"Categoria"))
tabla_m4 = merge(tabla_m4, tablam4_travel, by = c("Variable", "Label",
"Categoria"))
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(readxl)
library(dplyr)
library(gt)
library(tidyverse)
setwd("C:/Users/sergio.barona/Desktop/Natura/201025_Results/")
# --- Módulo 1 ---
tablam1_gender <- read_excel("output/m1/21102025_v2_mod1_by_gender.xlsx")
tablam1_ses    <- read_excel("output/m1/21102025_mod1_by_ses.xlsx")
tablam1_travel <- read_excel("output/m1/21102025_mod1_by_travel_mode.xlsx")
mod1 <- tablam1_gender %>%
inner_join(tablam1_ses, by = c("Variable", "Label", "Categoria")) %>%
inner_join(tablam1_travel, by = c("Variable", "Label", "Categoria"))
# --- Módulo 2 ---
tablam2_gender <- read_excel("output/m2/21102025_mod2_by_gender.xlsx")
tablam2_ses    <- read_excel("output/m2/21102025_mod2_by_ses.xlsx")
tablam2_travel <- read_excel("output/m2/21102025_mod2_by_travel_mode.xlsx")
mod2 <- tablam2_gender %>%
inner_join(tablam2_ses, by = c("Variable", "Label", "Categoria")) %>%
inner_join(tablam2_travel, by = c("Variable", "Label", "Categoria"))
# --- Módulo 3 ---
tablam3_gender <- read_excel("output/m3/21102025_mod3_by_gender.xlsx")
tablam3_ses    <- read_excel("output/m3/21102025_mod3_by_ses.xlsx")
tablam3_travel <- read_excel("output/m3/21102025_mod3_by_travel_mode.xlsx")
mod3 <- tablam3_gender %>%
inner_join(tablam3_ses, by = c("Variable", "Label", "Categoria")) %>%
inner_join(tablam3_travel, by = c("Variable", "Label", "Categoria"))
# --- Módulo 4 ---
tablam4_gender <- read_excel("output/m4/21102025_mod4_by_gender.xlsx")
tablam4_ses    <- read_excel("output/m4/21102025_mod4_by_ses.xlsx")
tablam4_travel <- read_excel("output/m4/21102025_mod4_by_travel_mode.xlsx")
mod4 <- tablam4_gender %>%
inner_join(tablam4_ses, by = c("Variable", "Label", "Categoria")) %>%
inner_join(tablam4_travel, by = c("Variable", "Label", "Categoria"))
mod1 %>%
head(20) %>%
gt(rowname_col = "Categoria") %>%
tab_header(
title = md("**Módulo 1. Características socio-demográficas**"),
subtitle = md("Distribución por género, nivel socioeconómico y modo de transporte")
) %>%
tab_spanner(label = "Género", columns = starts_with("Hombre") | starts_with("Mujer")) %>%
tab_spanner(label = "Nivel socioeconómico", columns = starts_with("Alto") | starts_with("Bajo") | starts_with("Medio")) %>%
tab_spanner(label = "Modo de transporte principal", columns = starts_with("Auto") | starts_with("Modo") | starts_with("Transporte")) %>%
cols_label(
Variable = "Variable",
Label = "Descripción",
p_value = html("**p-valor**")
) %>%
data_color(
columns = c("p_value.x", "p_value.y", "pvalue"),
colors = scales::col_bin(
bins = c(0, 0.05, 0.1, 1),
palette = c("#F94144", "#F8961E", "#90BE6D"),
na.color = "white"
)
) %>%
fmt_number(columns = c("p_value.x", "p_value.y", "pvalue"), decimals = 4) %>%
opt_table_font(font = list(google_font("Roboto Condensed"))) %>%
tab_options(
table.font.size = px(11),
data_row.padding = px(4),
heading.background.color = "#f8f9fa",
table.border.top.color = "white",
column_labels.border.bottom.color = "#dee2e6",
table.width = pct(100)
)
